<!DOCTYPE html>
<html>
  <head>
    <title>Fagdag på Sparebank1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script src="https://github.com/downloads/gnab/remark/remark-0.3.4.min.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://github.com/downloads/kjbekkelund/remark-bekk/bekk-0.0.3.js" type="text/javascript"></script>
    <link href="https://github.com/downloads/kjbekkelund/remark-bekk/bekk-0.0.3.css" type="text/css" rel="stylesheet">
    <style type="text/css" media="screen">
      #slideshow .slide .content.front-page h1 { width: 100%; }
      .slide p { padding: 0; margin: 1.1em 0; }
      .slide ul { padding: 0; margin: 1.1em 0; }
      .slide img { max-width: 100%; max-height: 600px; }
      #slideshow .slide .content ul li { padding-left: 1.3em; }
    </style>
  </head>
  <body>
    <textarea id="source">

.front-page

# Liv- og pensjonstjenesten

## ... på mobil!

Fagdag

Sparebank1 Liv

25/04/2012

---

.agenda

# Agenda

* Presentasjon av oppgaven
* Kort om JavaScript og REST
* Gjennomføring av oppgaven i grupper

---

# Oppgaven

Vi skal lage en veldig simplifisert versjon av LPT

… som er tilpasset mobiler.

Målet er å løse noen av de vanligste aktivitetene brukerne gjør i systemet.

**Vanligste kundeaktiviteter**

* Lønnsendring medlem
* Innmelding medlem
* Utmelding medlem

Forhåpentligvis rekker vi en kul oppgave til på slutten.

---

.middle.center

![](lpt.gif)

---

# Mobilteknologi

Med tanke på web finnes det nesten ingen *mobil*teknologi.

Men det er mye som passer veldig bra i den konteksten, for eksempel:

* Geolokasjon
* Offline-støtte
* Canvas (vi har jo ikke flash)

Og touch er så klart sentralt.

---

# JSF og mobil

I Sparebank1 brukes JSF stort sett over alt.

Men i det siste har Mobilbank-prosjektet og andre prosjekter basert seg på en annen arkitektur.

---

# JSF og mobil

JSF tar mange klare valg.

Støtter dårlig: HTML5, JSON og Ajax.

Veldig mye frontend er forsøkt abstrahert bort.

Primært leveranse av hele HTML-responser.

Fungerer bedre på desktop enn mobil.

Vanskelig å teste.

---

# REST

Arkitektur utviklet i parallell med HTTP.

Man sender representasjoner av ressurser, for eksempel i JSON- eller XML-format.

Klarere skille mellom backend og frontend — api!

HTTP-verb: GET, POST, PUT, DELETE

Det kan virke *vanskeligere*, men det er mindre *komplekst*.

---

# HTTP-verb

    .no-highlight
    HTTP GET    -> /users   = hent liste med brukere
    HTTP POST   -> /users   = lag en ny bruker
    HTTP PUT    -> /users/1 = endre bruker #1
    HTTP DELETE -> /users/1 = slett bruker #1

---

# Jersey

Oracles referanseimplementasjon av JAX-RS,

altså Java-APIet for å lage REST-tjenester.

Annotasjonsbasert.

    .java
    @PUT
    @Path("/member/{memberId}")
    @Produces({MediaType.APPLICATION_JSON, MediaType.APPLICATION_XML})
    @Consumes({MediaType.APPLICATION_JSON, MediaType.APPLICATION_XML})
    public Member editMember(@PathParam("memberId") int memberId, Member member){
        return DataStore.editMember(memberId, member);
    }

---

.middle.center

REST og JavaScript muliggjør nye måter å løse problemer.

(Altså: det er et nytt verktøy i verktøykassa)

---

.middle.center

Vi skal leke litt med jQuery Mobile

http://jquerymobile.com/

---

.middle.center

# Oppgavene

---

.middle.center

![](forside.png)

---

# HTML-en

    .html
    <!-- WELCOME PAGE -->
    <div id="welcome-page" data-role="page" data-theme="a">
    
      <div data-role="header">
        <img src="img/SB1_header_logo.png" class="logo" />
      </div>
    
      <div data-role="content">
        <h4>Velkommen til fagdag!</h4>
        <p>I løpet av noen timer skal dere lage LPT på mobil!</p>
        <ul id="company-list" data-role="listview" data-inset="true"></ul>
      </div>
    </div>

Så hvordan fyller vi inn firmalisten?

---

# JavaScript

    .javascript
    var list = $('#company-list');

    $.ajax({

      url: "http://lptdemo.herokuapp.com/rest/companies",

      dataType: "json",

      success: function(companies) {

        list.empty();

        for(var i = 0; i < companies.length; i++) {
          var company = companies[i];
          list.append('<li><a href="#agreement-list-page?companyid=' + company.id + '">' + 
              company.name + '</a></li>');
        }

        list.listview('refresh');

      }
    });

---

# JSON-responsen

    .javascript
    [
      { "id":35, "name": "Bekk Consulting AS", "agreements": [34,21,27] },
      { "id":49, "name": "EVRY AS",            "agreements": [48,38,44] },
      { "id":64, "name": "Statoil ASA",        "agreements": [55,58,63] },
      { "id":14, "name": "Veidekke ASA",       "agreements": [4,8,13]   }
    ]

---

.middle.center

![](avtaler.png)

---

# Få opp miljøet

Last ned `lpt.zip` fra `https://github.com/sagen/lpt-demo-server/downloads`

Inneholder:

* `index.html`
* `app.js`
* `framework.js`
* Notepad++
* WinSCP

---

# Oppsett av WinSCP

    .no-highlight
    Host: lpt.cookiejar.no
    Bruker/passord: gruppe{1,2,3,4}:gruppe{1,2,3,4}

Legg inn filene i web-mappa

Gå til http://lpt.cookiejar.no/{1,2,3,4}

Tips: `ctrl-u` i WinSCP holder remote directory i sync med lokalt

---

# Oppgave 1

Vise informasjon om en avtale.

URL: `http://lptdemo.herokuapp.com/rest/companies/{id}/agreements/{id}`

Eksempelrespons:

    .javascript
    {
      "id": 33,
      "members": [32,29,28,31,30],
      "type": "Innskuddspensjon med investeringsvalg",
      "agreementNumber": 589162912,
      "status": "Aktiv, ubehandlet endring",
      "registered": -304600985810,
      "minimumAge": 16
    }

---

# Oppgave 2

Vise liste med medlemmer tilknyttet en avtale

URL: `http://lptdemo.herokuapp.com/rest/companies/{id}/agreements/{id}/members`

Eksempelrespons:

    .javascript
    [
      {"id": 48,"fnr": "01013943423","name": "Mari Braathen",
        "salary": 810000,"registered": 704552360350},
      {"id": 46,"fnr": "25013947352","name": "Arne Braathen",
        "salary": 717000,"registered": 704552360350}
    ]

---

# Oppgave 3

Sidebytte og visning av medlemsinformasjon.

URL: `http://lptdemo.herokuapp.com/rest/companies/{id}/agreements/{id}/members/{id}`

Eksempelrespons:

    .javascript
    {
      "id": 46,
      "fnr": "25013947352",
      "name": "Anne Nilsen",
      "salary": 472000,
      "registered": 641483756989
    }

---

# Oppgave 4

Legge til og endre medlem.

Skal lage lenke, skjema og lagring av dataen.

Eksempel på lagring av data:

    .javascript
    var member = {
      fnr: "25013947352",
      name: "Anne Nilsen",
      salary: 1000
    };

    $.ajax({
      url: "http://lptdemo.herokuapp.com/rest/companies/{id}/agreements/{id}/members/{id}",
      contentType: "application/json",
      type: 'POST',
      data: JSON.stringify(member),
      dataType: "json",
      success: function(data){
      }
    });

For å legge til en medlem, fjern siste `/{id}` fra URL-en.

---

# Oppgave 5

Slette bruker.

Både med knapp og med swipe.

Sjekk ut `https://github.com/commadelimited/jquery.swipeButton.js`

---

# Oppgave 6

Vise veibeskrivelse til nærmeste Sparebank1-kontor.

Sjekk ut `navigator.geolocation`. Har en `displayMap`-hjelpemetode også.

    </textarea>
    <div id="slideshow"></div>
  </body>
</html>
